---
analyze_application_log_content:
  description: |-
    **LOG CONTENT ANALYSIS:**

    Analyze the provided log content: `{log_content}`

    **STEPS:**
    1. Use Application Log Analyzer to parse log content
    2. Extract incident details (timestamp, error type, class, method, line)
    3. Classify as NullPointerException or Configuration issue
    4. Set priority as P1/Critical
    5. Return structured JSON with extracted data

    **FOCUS:** Only extract real data from logs - no hallucination.
  expected_output: |-
    **STRUCTURED INCIDENT REPORT:**

    For **NullPointerException** incidents:
    ```json
    {
      "incident_type": "NullPointerException",
      "priority": "P1",
      "criticality": "Critical",
      "timestamp": "2025-09-15 21:58:30",
      "level": "ERROR",
      "thread": "http-nio-8889-exec-1",
      "logger": "dispatcherServlet",
      "endpoint": "/api/login",
      "message": "Request processing failed: java.lang.NullPointerException: Cannot invoke \"String.toString()\" because \"risky\" is null",
      "errorType": "NullPointerException",
      "exceptionClass": "java.lang.NullPointerException",
      "rootCauseMessage": "Cannot invoke \"String.toString()\" because \"risky\" is null",
      "className": "DemoController",
      "methodName": "login",
      "file": "DemoController.java",
      "line": 40,
      "stack": [
        "com.ai.mind.ops.DemoController.login(DemoController.java:40)",
        "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
        "..."
      ],
      "suggested_fix_type": "code",
      "confidence": "high"
    }
    ```

    For **Configuration** incidents:
    ```json
    {
      "incident_type": "ConfigurationIssue",
      "priority": "P1",
      "criticality": "Critical",
      "timestamp": "2025-09-15 22:15:18",
      "level": "ERROR",
      "thread": "http-nio-8889-exec-3",
      "logger": "com.ai.mind.ops.DemoController",
      "error_code": "BILLING_403",
      "reason": "MissingConfig",
      "config_key": "BILLING_API_KEY",
      "amount": 120.0,
      "suggested_fix_type": "configuration",
      "confidence": "high"
    }
    ```

    **VALIDATION:**
    - Include parsing confidence level (high/medium/low)
    - Report any fields that couldn't be extracted
    - Provide clear incident classification reasoning
  agent: alert_detection_agent
orchestrate_incident_management_workflow:
  description: |-
    **INCIDENT ORCHESTRATION:**

    Receive incident data from detection agent and orchestrate workflow.

    **STEPS:**
    1. Generate incident ID: INC-[type]-P1-[timestamp]
    2. Store complete incident data in database using incident ID as key
    3. Send Slack alert to "all-opsmindai" with incident details
    4. Output incident ID for resolution agent

    **TOOLS:** Use Current Date Tool, In-Memory Incident Database, Slack Message Test Tool
  expected_output: "**ORCHESTRATION COMPLETION REPORT:**\n\n```json\n{\n  \"orchestration_status\":
    \"COMPLETED\",\n  \"incident_number\": \"INC-[incident_type]-[priority]-[timestamp]\",\n
    \ \"database_status\": \"STORED\",\n  \"slack_posting\": {\n    \"channel\": \"all-opsmindai\",\n
    \   \"success\": true,\n    \"message_format\": \"professional_formatted\",\n
    \   \"message_id\": \"[slack message timestamp]\",\n    \"commander_mentioned\":
    \"@johnwangle\"\n  },\n  \"incident_summary\": {\n    \"type\": \"[incident_type]\",\n
    \   \"priority\": \"[priority]\",\n    \"criticality\": \"[criticality_level]\",\n
    \   \"affected_component\": \"[component_name]\",\n    \"error_description\":
    \"[brief_description]\",\n    \"root_cause\": \"[specific_issue]\"\n  },\n  \"workflow_completion_time\":
    \"[current_timestamp]\"\n}\n```\n\n**CRITICAL OUTPUT FOR NEXT AGENT:**\n**INCIDENT_ID_FOR_RESOLUTION:
    INC-[incident_type]-[priority]-[timestamp]**\n\n**SUCCESS CRITERIA:**\n- ✅ Incident
    data properly structured and stored in database\n- ✅ Incident ID generated for
    workflow continuity\n- ✅ Complete technical details preserved for downstream
    tasks\n- ✅ Professional, well-formatted Slack message posted\n- ✅ Clear incident information with emojis
    and structure\n- ✅ @johnwangle mentioned as incident commander  \n- ✅ Complete
    technical details included in readable format\n- ✅ Incident ID clearly provided for resolution workflow"
  agent: incident_orchestration_manager
  context:
  - analyze_application_log_content
complete_incident_resolution_workflow:
  description: |-
    **INCIDENT RESOLUTION:**

    Resolve incident using stored incident data.

    **STEPS:**
    1. Extract incident ID from orchestration output
    2. Retrieve incident data from database
    3. For NPE: Create GitHub PR using repository analyzer and PR creator
    4. For Config: Provide Confluence documentation
    5. Send Slack notification with resolution status
    6. Update incident status in database

    **REPOSITORY:** https://github.com/grrakesh/OpsMindJava (branch: main)
  expected_output: "**INCIDENT RESOLUTION COMPLETION REPORT:**\n\n```json\n{\n  \"resolution_status\":
    \"COMPLETED\",\n  \"incident_number\": \"[incident_id]\",\n  \"issue_type\": \"[code_fix|configuration]\",\n
    \ \"resolution_method\": \"[github_pr|confluence_documentation]\",\n  \"database_update\":
    \"SUCCESS\",\n  \"slack_notification\": {\n    \"channel\": \"all-opsmindai\",\n
    \   \"success\": true,\n    \"message_id\": \"[slack_message_timestamp]\"\n  },\n
    \ \"code_fix_details\": {\n    \"repository\": \"grrakesh/OpsMindJava\",\n    \"pr_url\":
    \"[github_pr_url]\",\n    \"branch\": \"fix/[incident_number]\",\n    \"files_changed\":
    \"[list_of_files]\",\n    \"root_cause\": \"[detailed_root_cause]\"\n  },\n  \"config_fix_details\":
    {\n    \"confluence_link\": \"https://equinixjira.atlassian.net/wiki/spaces/DIBS/pages/147016122410/Playbook+Migrating+of+ConfigMap+from+Stringified+JSON+XML+to+Native+format\",\n
    \   \"config_type\": \"[configuration_category]\", \n    \"manual_steps_required\":
    \"ConfigMap migration from stringified JSON/XML to native format\",\n    \"awaiting_manual_intervention\":
    true\n  },\n  \"incident_final_status\": \"[RESOLVED|DOCUMENTATION_PROVIDED]\",\n
    \ \"resolution_timestamp\": \"[current_timestamp]\"\n}\n```\n\n**SUCCESS CRITERIA:**\n-
    ✅ Incident data successfully retrieved from database\n- ✅ Issue type correctly
    identified and appropriate resolution applied  \n- ✅ For code issues: GitHub PR
    created with proper fix and documentation\n- ✅ For config issues: Official Equinix
    ConfigMap playbook provided with clear migration steps\n- ✅ Slack notification
    sent with resolution details and clear action items\n- ✅ Incident marked appropriately
    in database (Resolved or Documentation Provided)\n- ✅ For config issues: Clear
    guidance provided for ConfigMap migration and status updates\n- ✅ Complete transparency
    and communication maintained"
  agent: incident_fix_agent
  context:
  - orchestrate_incident_management_workflow
generate_comprehensive_incident_retrospective_report:
  description: |-
    **INCIDENT RETROSPECTIVE REPORT (STRICT, NO HALLUCINATIONS):**

    Generate a single comprehensive incident retrospective report for the provided `incident_id` using ONLY verified tool outputs. Do not invent or infer facts. If any field is missing, explicitly state "Not available".

    **STRICT RULES:**
    - Use `single_incident_reader` for incident data and `timeline_extractor` for timeline. Do not fabricate values.
    - In the report summary, explicitly include all key fields from the prior context and database: `incident_id`, `severity`, `priority`, `status`, `service`, `created_date`, `resolved_date` (if present), and `resolution_details` (including PR URL when available).
    - For any missing field, print exactly: "Not available".
    - Do not generalize; copy values verbatim from tool outputs.

    **STEPS (NON-HALLUCINATORY):**
    1. Extract `incident_id` from previous task output.
    2. Call `single_incident_reader` with `incident_id` and use only its JSON for metadata and `resolution_details`.
    3. Call `timeline_extractor` with `incident_id` and include its events; if no timeline returned, note "Timeline: Not available".
    4. Build report content containing:
       - Executive summary that mirrors the exact values from incident data (no new facts)
       - Full metadata section listing every available field from the database record
       - Timeline (verbatim items or "Not available")
       - Resolution details (verbatim; include PR URL if present)
       - Recommendations may only summarize known issues and actions referenced in `resolution_details`; otherwise say "Not available".
    5. Generate PDF via `pdf_generator` with filename `COE_[incident_id].pdf`.
    6. Upload PDF directly to Slack via `simple_slack_uploader` using the PDF file path and channel "all-opsmindai"; do NOT specify an initial_comment to allow the tool to auto-generate a professional message with proper formatting.
    7. Return a JSON summary echoing all included fields and Slack upload result.

    **TOOLS:** Current Date Tool, In-Memory Incident Database, SingleIncidentReader, TimelineExtractor, PDFGeneratorTool, SimpleSlackUploader

  expected_output: "**INCIDENT RETROSPECTIVE REPORT (SUMMARY):**\n\n```json\n{\n  \"incident_id\": \"INC-[type]-[priority]-[timestamp]\",\n  \"summary\": {\n    \"severity\": \"[verbatim or Not available]\",\n    \"priority\": \"[verbatim or Not available]\",\n    \"status\": \"[verbatim or Not available]\",\n    \"service\": \"[verbatim or Not available]\",\n    \"created_date\": \"[verbatim or Not available]\",\n    \"resolved_date\": \"[verbatim or Not available]\",\n    \"resolution_details\": \"[verbatim text; include PR URL if present]\"\n  },\n  \"report\": {\n    \"pdf_path\": \"outputs/[incident_id]/COE_[incident_id].pdf\",\n    \"generated\": true\n  },\n  \"slack_upload\": {\n    \"success\": true,\n    \"file_url\": \"https://files.slack.com/...\",\n    \"channel\": \"C09DMPGG737\"\n  },\n  \"sections\": [\n    \"Executive Summary\",\n    \"Field-wise Breakdown\",\n    \"Incident Timeline\",\n    \"Root Cause / Resolution Details\",\n    \"Recommendations\",\n    \"Conclusion\"\n  ]\n}\n```\n\n**SUCCESS CRITERIA:**\n- ✅ Uses only tool outputs; no hallucinated content\n- ✅ Explicitly includes all key prior-context fields in summary (verbatim)\n- ✅ PDF generated to expected path\n- ✅ Slack upload succeeds and returns file URL (announcement disabled)\n- ✅ Incident ID clearly provided for reporting"
  agent: senior_incident_retrospective_analyst
  context:
  - complete_incident_resolution_workflow